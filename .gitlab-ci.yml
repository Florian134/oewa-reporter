# Ã–WA Reporter - GitLab CI/CD Pipeline
# =====================================
# Triggered by Airtable Automations or GitLab Schedules

stages:
  - run

variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"

# Cache fÃ¼r schnellere Builds
cache:
  paths:
    - .cache/pip/

# =============================================================================
# MAIN JOB - FÃ¼hrt das passende Script basierend auf JOB_TYPE aus
# =============================================================================
run_job:
  stage: run
  image: python:3.11-slim
  before_script:
    - pip install --upgrade pip
    - pip install requests python-dotenv openai
  script:
    - echo "ðŸš€ Ã–WA Reporter Pipeline"
    - echo "Job Type: ${JOB_TYPE:-daily}"
    - |
      if [ "${JOB_TYPE}" = "weekly" ]; then
        echo "ðŸ“Š Running Weekly Report..."
        python scripts/weekly_report.py
      elif [ "${JOB_TYPE}" = "monthly" ]; then
        echo "ðŸ“ˆ Running Monthly Report..."
        python scripts/monthly_report.py
      else
        echo "ðŸ“¥ Running Daily Ingestion..."
        python scripts/daily_ingest.py
      fi
    - echo "âœ… Job completed!"
  rules:
    # Nur bei Trigger oder Schedule ausfÃ¼hren
    - if: $CI_PIPELINE_SOURCE == "trigger"
    - if: $CI_PIPELINE_SOURCE == "schedule"
    - if: $CI_PIPELINE_SOURCE == "web"  # Manuell aus GitLab UI
